<div ng-show="action[0]=='form'">
<h2>
  Compare Models Form
  <small>
      <a ng-href="#" href="#">(Cancel)</a>
  </small>
</h2>
</div>

<div ng-show="action[0]=='report'">
    <h2>Comparing tests
    <div class="actions">
        <a class="btn btn-info" ng-click="toogleReportSection('metrics')">
            <i class="icon-th-list"></i> Metrics
        </a>
        <a class="btn btn-info" ng-click="toogleReportSection('examples')">
            <i class="icon-search"></i> Examples
        </a>
        <a class="btn" ng-click="backToForm()">
            <i class="icon-arrow-left"></i> Back
        </a>
    </div>
    </h2>
    
</div>

<alert-message ng-show="err" class="alert-error" msg="{{ err }}" unsafe></alert-message>

<loadindicator
  title="Generating report..."
  ng-show="generating"
  progress="generatingProgress">
</loadindicator>

<form ng-show="action[0]=='form'" name="CompareModelsForm" class="form-horizontal">
  <p class="lead">
    Please choose to models with test to compare
  </p>
  <div class="control-group" ng-class="{error: UploadModelForm.name.$invalid}">
    <label class="control-label">Model/Test 1</label>
    <div class="controls">
      <select ng-model="model1" name="model1" ng-options="m.name for m in models" name="model1" ng-selected="model1.name" required>
        <option value="">--- select model ---</option>
      </select>
      <select ng-model="test1" ng-options="m.name for m in model1.tests" name="test1" ng-selected="test1.name" required>
        <option value="">--- select test ---</option>
      </select>
      <span ng-show="CompareModelsForm.model1.$error.required || CompareModelsForm.test1.$error.required" class="help-inline">Required</span>

      <span class="help-block">TODO: you could choose only trained model with successfull completed tests</span>
    </div>
  </div>

  <div class="control-group" ng-class="{error: UploadModelForm.name.$invalid}">
    <label class="control-label">Model/Test 2</label>
    <div class="controls">
      <select ng-model="model2" name="model2" ng-selected="model2.name" ng-options="m.name for m in models" name="model2" required>
        <option value="">--- select model ---</option>
      </select>
      <select ng-model="test2" name="test2" ng-selected="test2.name" ng-options="m.name for m in model2.tests" required>
        <option value="">--- select test ---</option>
      </select>
      <span ng-show="CompareModelsForm.model2.$error.required || CompareModelsForm.test2.$error.required" class="help-inline">Required</span>

      <span class="help-block">TODO: you could choose only trained model with successfull completed tests</span>
    </div>
  </div>

  <br />
  <a href="#/models" class="btn">Cancel</a>
  <button ng-click="generateReport()" ng-disabled="CompareModelsForm.$invalid"
          class="btn btn-primary">Compare</button>
</form>

<div ng-show="action[0]=='report' && section=='examples'">
    <h4>Examples comparation</h4>
    <alert-message ng-show="!report.test1.examples.length" class="alert-warning" msg="{{ report.test1.fullName() }} has not any examples" unsafe></alert-message>
    <alert-message ng-show="!report.test2.examples.length" class="alert-warning" msg="{{ report.test2.fullName() }} has not any examples" unsafe></alert-message>
    <table ng-show="report.test1.examples.length || report.test2.examples.length" class="table table-bordered">
        <col style="width: 2%;" />
        <col style="width: 49%;" />
        <col style="width: 49%;" />
        <thead>
            <tr>
                <th></th>
                <th ng-show="report.test1.examples.length"><a target="_blank" href="#{{ report.test1.objectUrl() }}">{{ report.test1.fullName() }}</a></th>
                <th ng-show="report.test2.examples.length"><a target="_blank" href="#{{ report.test2.objectUrl() }}">{{ report.test2.fullName() }}</a></th>
            </tr>
        </thead>
        <tbody ng-init="states={}">
            <tr ng-repeat="i in [] | range:10">
                <td>{{ i + 1 }}</td>
                <td ng-show="report.test1.examples.length">
                  <div>
                    Label<span class="value">{{ report.test1.examples[i].label }}</span>
                  </div>
                  <div>
                    Predicted Label<span class="value">{{ report.test1.examples[i].pred_label }}</span>
                  </div>
                  <a ng-click="states[i]=!states[i]">Features with weights</a>
                  <div ng-show="states[i]" ng-repeat="(title, val) in report.test1.examples[i].weighted_data_input">
                    <small>
                      <span>{{ title }}</span>
                      <weighted-data-parameters val="val" />
                  </small>
                </div>
                </td>
                <td ng-show="report.test2.examples.length">
                  <div>
                    Label<span class="value">{{ report.test2.examples[i].label }}</span>
                  </div>
                  <div>
                    Predicted Label<span class="value">{{ report.test2.examples[i].pred_label }}</span>
                  </div>
                   <a ng-click="states[i]=!states[i]">Features with weights</a>
                  <div ng-show="states[i]" ng-repeat="(title, val) in report.test2.examples[i].weighted_data_input">
                    <small>
                      <span>{{ title }}</span>
                      <weighted-data-parameters val="val" />
                  </small>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div ng-show="action[0]=='report' && section=='metrics' && !generating">
  <h4>Metrics</h4>
  <table class="table table-bordered">
      <colgroup>
          <col style="width:100px;">
      </colgroup>
      <thead>
          <tr>
              <th></th>
              <th><a target="_blank" href="#{{ report.test1.objectUrl() }}">{{ report.test1.fullName() }}</a></th>
              <th><a target="_blank" href="#{{ report.test2.objectUrl() }}">{{ report.test2.fullName() }}</a></th>
          </tr>
      </thead>
      <tbody>
          <tr>
              <th>Accuracy</th>
              <td>{{ report.test1.accuracy.toFixed(4) }}</td>
              <td>{{ report.test2.accuracy.toFixed(4) }}</td>
          </tr>
          <tr>
              <th>Confusion Matrix</th>
              <td>
                  <confusion-matrix matrix=report.test1.metrics["confusion_matrix"] ></confusion-matrix>
              </td>
              <td>
                  <confusion-matrix matrix=report.test2.metrics["confusion_matrix"] ></confusion-matrix>
              </td>
          </tr>
      </tbody>
  </table>
  <hr />
  <div class="span5">
    <h4>ROC curves</h4>
    <sc-curves xlabel="False-positive rate" ylabel="True-positive rate" curves-dict="report.rocCurves" show-line="1" width="500"></sc-curves>
  </div>
  <div class="span5 offset1">
    <h4>Precision Recall curves</h4>
    <sc-curves xlabel="Recall" ylabel="Precision" curves-dict="report.precisionRecallCurves" width="500"></sc-curves>
  </div>
</div>