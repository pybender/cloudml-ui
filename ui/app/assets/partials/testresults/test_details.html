<h2 ng-show="test.loaded">
  {{ test.name|capfirst }} Details
  <div class="actions">
    <a ng-show="test.status == 'Completed'" class="btn btn-info" ng-click="downloadCsvResults()">
      <i title="Download test examples" class="icon-download-alt"></i> Classification Results in CSV
    </a>
  </div>
</h2>

<div title="quick info" ng-init="obj=test">
  <ng-include src="'/partials/parts/created_tags.html'"></ng-include>
  <i class="icon-status"></i>
  <span class="badge badge-warning">{{ test.status }}</span>
</div>
<p></p>

<alert-message ng-hide="test.loaded" class="alert-info" msg="Loading..." unsafe></alert-message>

<alert-message ng-show="test.loaded && test.status != 'Completed'" class="alert-warning" msg="Test was not calculated yet. Status: {{ test.status }}" unsafe></alert-message>

<alert-message ng-show="test.error" class="alert-error" msg="{{ test.error }}" unsafe></alert-message>

<div>
  <ul class="nav nav-tabs" id="tabs">
    <li ng-show="showdetails" ng-class="{active: action[0] == 'metrics'}"><a ng-click="setSection(['metrics', 'accuracy'])">Metrics</a></li>
    <li ng-show="showdetails" ng-class="{active: action[0] == 'matrix'}"><a ng-click="setSection(['matrix', 'confusion'])">Confusion Matrix</a></li>
    <li ng-show="showdetails" ng-show="test.status == 'Completed'" ng-class="{active: action[0] == 'examples'}"><a ng-click="setSection(['examples', 'list'])">Examples</a></li>
    <li ng-class="{active: action[0] == 'about'}"><a ng-click="setSection(['about', 'details'])">About</a></li>
    <li ng-class="{active: action[0] == 'logs'}"><a ng-click="setSection(['logs', 'list'])">Logs</a></li>
  </ul>

    <div class="tab-content">
      <div ng-show="action[0] == 'about'">
        <div class="row">
            <div class="span8">
                <div>
                    Import parameters:
                    <span class="value">{{ test.parameters }}</span>
                </div>
                <div>
                    Classes Set:
                    <span class="value">
                        <span ng-repeat='cls in test.classes_set'><span class="label">{{ cls }}</span> </span> 
                    </span>
                </div>
                <div ng-show="test.dataset" title="DataSet which was used for running test">
                  DataSet:
                  <span class="value">
                    <a href="#{{ test.dataset_obj.objectUrl() }}">
                    {{ test.dataset_obj.name }}</a>
                  </span>
                </div>
                <div>
                    Examples count: <span class="value">{{ test.examples_count }}</span>
                </div>
                <div>
                    Memory used: <span class="value">{{ test.memory_usage.testing }} Mb</span>
                </div>
                <div ng-show="test.created_by">
                    Created by:
                    <span class="value">{{ test.created_by.name }} ({{ test.created_by.uid }})</span>
                </div>

                <div ng-controller="TestExportsCtrl" ng-init="init(test)">
                    <div ng-show="exports">
                    <b>CSV Exports:</b><br>
                    <ul>
                    <li ng-repeat="export in exports">
                        <i>{{ export.datetime|format_date }}</i>
                        <span ng-repeat="field in export.fields" class="badge">{{ field }}</span>
                        <span class="badge badge-info">{{ export.status }}</span>
                        <a ng-show="export.status == 'Completed'" class="btn btn-small" href="{{ export.url }}">Download</a>
                    </li>
                    </ul>
                    </div>
                </div>

            </div>
        </div>
      </div>

      <div ng-show="action[0] == 'metrics'">
        <div>
          <div>
              Classification Accuracy: <span class="value">{{ test.accuracy.toFixed(4) }}</span>
          </div>
        </div>
        <hr/>
        <div>
          <h4>Receiver operating characteristic</h4>
          <p>The Area Under an ROC Curve: 
              <span>{{ test.metrics.roc_auc.toFixed(4) }}</span>
          </p>
          <sc-curves xlabel="False-positive rate" ylabel="True-positive rate" curves-dict="rocCurve" show-line="1" width="500"></sc-curves>
        </div>
        <hr/>
        <div>
          <h4>Precision-Recall</h4>
          <sc-curves xlabel="Recall" ylabel="Precision" curves-dict="prCurve" width="500"></sc-curves>
        </div>
        <hr/>
        <a ng-show="test.status == 'Completed'" href="#{{ test.avaragePrecisionUrl() }}"><i class="status-icon icon-search"></i> Average precision</a>
      </div>

      <div ng-show="action[0] == 'examples'" ng-controller="TestExamplesCtrl" ng-init="init(test)">
        <ng-include src="'/partials/examples/example_list.html'"></ng-include>
      </div>

      <div ng-show="action[0] == 'matrix'">
        <div class="row">
            <div class="span6">
                <h4>Confusion Matrix</h4>

                <form name="ConfusionMatrixForm" class="form-inline well">

                  <div class="alert alert-error" ng-show="confusion_matrix_weights.error">
                      {{ confusion_matrix_weights.error }}
                  </div>

                  <label>Weight of &quot;{{ test.model.labels[0] }}&quot;: </label>
                  <input type="text" name="weight0" class="input-mini" ng-model="confusion_matrix_weights.w0" required smart-float>

                  <label>Weight of &quot;{{ test.model.labels[1] }}&quot;: </label>

                  <input type="text" name="weight1" class="input-mini" ng-model="confusion_matrix_weights.w1" required smart-float>

                  <button ng-disabled="ConfusionMatrixForm.$invalid" class="btn" ng-click="recalculateConfusionMatrix(confusion_matrix_weights.w0, confusion_matrix_weights.w1)">
                      Recalculate with weights
                  </button>
                </form>

                <confusion-matrix matrix=test.metrics.confusion_matrix url=test.examplesUrl()></confusion-matrix>

            </div>
        </div>
      </div>

      <div ng-show="action[0] == 'logs'" ng-controller="LogMessageListCtrl" ng-init="init('runtest_log', test._id)">
        <ng-include src="'/partials/logmessages/list.html'"></ng-include>
      </div>

    </div>
</div>